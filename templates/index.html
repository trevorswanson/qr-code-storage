<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Home QR Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">
    <div class="max-w-xl mx-auto">
        <div class="flex justify-between items-center mb-4">
            <h1 class="text-2xl font-bold">Smart Home QR Code Manager</h1>
            <div>
                <a href="{{ url_for('add_device') }}" class="text-blue-600 underline mr-4">Add Device</a>
                <a href="{{ url_for('settings') }}" class="text-blue-600 underline">Settings</a>
            </div>
        </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <ul class="mb-4">
            {% for category, message in messages %}
                <li class="text-{{ 'red' if category == 'error' else 'green' }}-600">
                    <strong>{{ category.title() }}:</strong> {{ message }}
                </li>
            {% endfor %}
            </ul>
        {% endif %}
    {% endwith %}

    <h2 class="text-xl font-semibold mb-2">Stored Devices</h2>
    <form method="get" class="mb-4">
        <label class="mr-2">Sort by:</label>
        <select name="sort" onchange="this.form.submit()" class="border p-1">
            <option value="room" {% if sort_by == 'room' %}selected{% endif %}>Room</option>
            <option value="category" {% if sort_by == 'category' %}selected{% endif %}>Category</option>
        </select>
    </form>
    <ul>
    {% for name, info in devices.items() %}
        <li class="mb-4">
            <div>
                <span class="font-medium">{{ name }}</span>
                {% if info.category %}<span class="text-sm text-gray-600 ml-2">({{ info.category }})</span>{% endif %}
                {% if info.room %}<span class="text-sm text-gray-600 ml-2">- {{ info.room }}</span>{% endif %}
                <a href="{{ url_for('edit_device', name=name) }}" class="text-blue-600 underline ml-2">Edit</a>
                <button class="text-blue-600 underline ml-2" onclick="toggleQr('{{ name }}')">View QR</button>
            </div>
            <img id="{{ name }}-qr" src="{{ url_for('get_qr', name=name) }}" alt="QR for {{ name }}" class="mt-2 hidden w-40 h-40">
        </li>
    {% else %}
        <li>No devices saved yet.</li>
    {% endfor %}
    </ul>

    </div>

    <script>
        function toggleQr(name) {
            const img = document.getElementById(`${name}-qr`);
            if (img) {
                img.classList.toggle('hidden');
            }
        }
    </script>
</body>
</html>
